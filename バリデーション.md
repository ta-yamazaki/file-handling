# ファイルアップロード時のバリデーション

| バリデーション項目 | 説明                                                 | 実装                                                                                                                                             |
|-----------|----------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| 存在確認      | ファイルが空でないか                                         | MultipartFile.isEmpty                                                                                                                          |
| ファイル形式    | 指定されたファイル形式（拡張子）に合致しているか                           | MediaType.parseMediaType(file.getContentType();<br>FilenameUtils.getExtension(file.getOriginalFilename());<br>※画像の場合これもあり？→ImageIO.read(file); |
| バイナリチェック  | ファイルの中身をバイナリチェック                                   |                                                                                                                                                |
| ファイルサイズ   | 許容範囲を超えていないか                                       | spring.servlet.multipart.max-file-size=20MB                                                                                                    |
| ユニーク性     | ハッシュを見る。メタデータも                                     |                                                                                                                                                |
| ファイル名     | ファイル名に、不正な文字や特殊文字・パス・スクリプトタグが含まれていないか              | String.contains()                                                                                                                              |
| ファイル内容    | CSV/Excelファイルの場合、ヘッダやデータ形式の妥当性を検証。テキストの場合、文字コードを検証 | apache.poi                                                                                                                                     |
| ユーザー権限    | 許可されたユーザーによるアップロードか                                | @PreAuthorize("hasPermission()")                                                                                                               |
| ウイルスチェック  |                                                    |                                                                                                                                                |


| バリデーション項目 | エラーメッセージ                                              |
|-----------|-------------------------------------------------------|
| 存在確認      | ファイルが存在しません。ファイルを選択してください。                            |
| ファイル形式    | アップロードできるファイル形式は～～です。                                 |
| バイナリチェック  | ファイルの内容が適切ではありません。                                    |
| ファイルサイズ   | アップロードできるファイルサイズは～～までです。                              |
| ユニーク性     | すでに存在しているファイルです。別のファイルを選択してください。                      |
| ファイル名     | ファイル名に不正な文字が含まれています。ファイル名に特殊文字・パス・スクリプトタグは使用しないでください。 |
| ファイル内容    | ファイルの内容が適切ではありません。                                    |
| ユーザー権限    | ファイルアップロードの権限がありません。                                  |
| ウイルスチェック  | アップロードしたファイルがウイルス感染している恐れがあります                        |
