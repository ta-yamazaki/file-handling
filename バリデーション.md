# ファイルアップロード時のバリデーション

| バリデーション項目      | 説明                                                 | 実装                                                                                  |
|----------------|----------------------------------------------------|-------------------------------------------------------------------------------------|
| 存在確認〇          | ファイルが空でないか                                         | MultipartFile.isEmpty                                                               |
| ユニーク性〇         | ハッシュを見る。メタデータも                                     |                                                                                     |
| ファイル名重複〇       | ファイル名がすでに使われていないか。                                 |                                                                                     |
| ファイル名長さ〇       | ファイル名が長すぎないか。                                      |                                                                                     |
| ファイル名不正文字〇     | ファイル名に、不正な文字や特殊文字・パス・スクリプトタグが含まれていないか。すでに使われていないか。 |                                                                                     |
| ファイル拡張子〇       | 指定されたファイル拡張子に合致しているか                               | FilenameUtils.getExtension(file.getOriginalFilename());                             |
| ファイルメディアタイプ〇   | 指定されたファイルメディアタイプに合致しているか                           | MediaType.parseMediaType(file.getContentType();<br>※画像の場合これもあり？→ImageIO.read(file); |
| ファイルフォーマット〇    | ファイルの中身をバイナリチェック                                   |                                                                                     |
| ファイルサイズ〇       | 許容範囲を超えていないか                                       | spring.servlet.multipart.max-file-size=20MB                                         |
| ファイル内容(Excel)〇 | ヘッダやデータ形式の妥当性を検証                                   | apache.poi                                                                          |
| ファイル内容(テキスト)   | テキストの場合、文字コードを検証                                   |                                                                                     |
| ユーザー権限〇        | 許可されたユーザーによるアップロードか                                | @PreAuthorize("hasPermission()")                                                    |
| ウイルスチェック〇      |                                                    |                                                                                     |
